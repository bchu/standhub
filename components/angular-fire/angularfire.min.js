"use strict";function AngularFire(e,n,i,r){this._q=e,this._parse=n,this._timeout=i,this._initial=!0,this._remoteValue=!1,this._fRef="string"==typeof r?new Firebase(r):r}angular.module("firebase",[]).value("Firebase",Firebase),angular.module("firebase").factory("angularFire",["$q","$parse","$timeout",function(e,n,i){return function(r,t,a,o){var u=new AngularFire(e,n,i,r);return u.associate(t,a,o)}}]),AngularFire.prototype={disassociate:function(){var e=this;e._unregister&&e._unregister(),this._fRef.off("value")},associate:function(e,n,i){var r=this;void 0==i&&(i=[]);var t=this._q.defer(),a=t.promise;return this._fRef.on("value",function(a){var o=!1;if(t&&(o=t,t=!1),r._remoteValue=i,a&&void 0!=a.val()){var u=a.val();if(typeof u!=typeof i)return r._log("Error: type mismatch"),void 0;var s=Object.prototype.toString;if(s.call(i)!=s.call(u))return r._log("Error: type mismatch"),void 0;if(r._remoteValue=angular.copy(u),angular.equals(u,r._parse(n)(e)))return}r._timeout(function(){r._resolve(e,n,o,r._remoteValue)})}),a},_log:function(e){console&&console.log&&console.log(e)},_resolve:function(e,n,i,r){var t=this;this._parse(n).assign(e,angular.copy(r)),this._remoteValue=angular.copy(r),i&&(i.resolve(function(){t.disassociate()}),this._watch(e,n))},_watch:function(e,n){var i=this;i._unregister=e.$watch(n,function(){if(i._initial)return i._initial=!1,void 0;var r=JSON.parse(angular.toJson(i._parse(n)(e)));angular.equals(r,i._remoteValue)||i._fRef.ref().set(r)},!0)}},angular.module("firebase").factory("angularFireCollection",["$timeout",function(e){function n(e,n){this.$ref=e.ref(),this.$id=e.name(),this.$index=n,angular.extend(this,{priority:e.getPriority()},e.val())}return function(i,r){function t(e){return e?v[e]+1:0}function a(e,n){v[n.$id]=e,l.splice(e,0,n)}function o(e){var n=v[e];l.splice(n,1),v[e]=void 0}function u(e,n){l[e]=n}function s(e,n,i){l.splice(e,1),l.splice(n,0,i),f(e,n)}function f(e,n){var i=l.length;n=n||i,n>i&&(n=i);for(var r=e;n>r;r++){var t=l[r];t.$index=v[t.$id]=r}}var c,l=[],v={};return c="string"==typeof i?new Firebase(i):i,r&&"function"==typeof r&&c.once("value",r),c.on("child_added",function(i,r){e(function(){var e=t(r);a(e,new n(i,e)),f(e)})}),c.on("child_removed",function(n){e(function(){var e=n.name(),i=v[e];o(e),f(i)})}),c.on("child_changed",function(i,r){e(function(){var e=v[i.name()],a=t(r),o=new n(i,e);u(e,o),a!==e&&s(e,a,o)})}),c.on("child_moved",function(n,i){e(function(){var e=v[n.name()],r=t(i),a=l[e];s(e,r,a)})}),l.add=function(e,n){var i;return i=n?c.ref().push(e,n):c.ref().push(e)},l.remove=function(e){var n=angular.isString(e)?l[v[e]]:e;n.$ref.remove()},l.update=function(e){var n=angular.isString(e)?l[v[e]]:e,i={};angular.forEach(n,function(e,n){0!==n.indexOf("$")&&(i[n]=e)}),n.$ref.set(i)},l}}]);